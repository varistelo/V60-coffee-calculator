<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
        <title>V60 Calculator</title>
    <link rel="stylesheet" href="css/style.css?v=1.0">
    <link rel="icon" href="images/v60.svg" type="image/svg+xml">
    <link rel="manifest" href="manifest.json">
    <meta name="description" content="Calculadora para preparo de caf√© utilizando o m√©todo V60 4:6.">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="V60 Caf√©">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6c3428">
    <meta name="apple-touch-fullscreen" content="yes">
    
    <!-- iOS espec√≠fico - usar PNG para melhor compatibilidade -->
    <link rel="apple-touch-icon" href="images/v60-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/v60-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/v60-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="images/v60-192.png">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <img src="images/v60.svg" alt="V60 dripper" class="coffee-cup-illustration" width="80" height="80" style="width: 80px !important; height: 80px !important; max-width: 80px !important; max-height: 80px !important;">
            <div class="header-text">
                <p class="method-label">M√©todo 4:6</p>
                <h1>Calculadora V60</h1>
                <div class="subtitle-tags">
                    <span class="info-tag volume-tag" id="volume-display"></span>
                    <span class="info-tag type-tag" id="type-display"></span>
                    <span class="info-tag flavor-tag-taste" id="taste-display"></span>
                    <span class="info-tag flavor-tag-strength" id="strength-display"></span>
                </div>
            </div>
        </div>
        
        <form id="coffee-form">
            <!-- Se√ß√£o b√°sica com quantidade e tipo de caf√© -->
            <div class="basic-control">
                <p class="control-label">
                    Volume e Esp√©cie
                    <button type="button" class="toggle-btn" title="Expandir/Recolher">&#9650;</button>
                </p>
                
                <div class="basic-fields">
                    <label for="coffee-quantity">Quantidade de Caf√© (ml):</label>
                    <input type="number" id="coffee-quantity" min="100" max="1000" value="300" required>
                    
                    <p class="form-label">Tipo de Caf√©:</p>
                    <div class="radio-options">
                        <div class="radio-option">
                            <input type="radio" id="arabica" name="coffee-type" value="arabica" checked>
                            <label for="arabica">Ar√°bica (15:1)</label>
                        </div>
                        
                        <div class="radio-option">
                            <input type="radio" id="conilon" name="coffee-type" value="conilon">
                            <label for="conilon">Conilon (18:1)</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section-divider"></div>
            
            <!-- Se√ß√£o de controle de sabor - j√° existente -->
            <div class="flavor-control">
                <p class="control-label">
                    Controles de sabor
                    <button type="button" class="toggle-btn" title="Expandir/Recolher">&#9650;</button>
                </p>
                
                <div class="slider-container">
                    <label for="acidity-slider">SABOR</label>
                    <input type="range" id="acidity-slider" min="0" max="2" value="2" step="1" class="tristate-slider">
                    <div class="slider-values">
                        <span class="left-value">√Åcido</span>
                        <span class="center-value">Equilibrado</span>
                        <span class="right-value active">Doce</span>
                    </div>
                </div>
                
                <div class="slider-container">
                    <label for="strength-slider">INTENSIDADE</label>
                    <input type="range" id="strength-slider" min="0" max="2" value="2" step="1" class="tristate-slider">
                    <div class="slider-values">
                        <span class="left-value">Leve</span>
                        <span class="center-value">M√©dio</span>
                        <span class="right-value active">Forte</span>
                    </div>
                </div>
            </div>
            
            <div class="section-divider solid"></div>

            <button type="submit">Calcular</button>
        </form>

        <div id="result" class="result"></div>
    </div>

    <script src="js/calculator.js?v=1.0"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado com sucesso!', registration.scope);
                        
                        // Verificar se h√° uma nova vers√£o dispon√≠vel
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nova vers√£o dispon√≠vel
                                    if (confirm('Nova vers√£o da Calculadora V60 dispon√≠vel! Deseja atualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('‚ùå Erro ao registrar Service Worker:', error);
                    });
            });

            // Mostrar prompt de instala√ß√£o do PWA
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('üí° PWA pode ser instalado!');
                
                // Prevenir o prompt autom√°tico
                e.preventDefault();
                
                // N√ÉO mostrar bot√£o - easter egg ser√° ativado via JavaScript
                // showInstallButton();
            });

            // Fun√ß√£o para mostrar bot√£o de instala√ß√£o
            function showInstallButton() {
                // Criar bot√£o de instala√ß√£o se n√£o existir
                if (!document.getElementById('install-button')) {
                    const installButton = document.createElement('button');
                    installButton.id = 'install-button';
                    installButton.innerHTML = 'üì± Instalar App';
                    installButton.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        padding: 12px 16px;
                        border-radius: 25px;
                        font-weight: 600;
                        cursor: pointer;
                        box-shadow: 0 4px 12px rgba(108, 52, 40, 0.3);
                        z-index: 1000;
                        font-size: 14px;
                        transition: all 0.3s ease;
                    `;
                    
                    installButton.addEventListener('click', async () => {
                        if (deferredPrompt) {
                            deferredPrompt.prompt();
                            const { outcome } = await deferredPrompt.userChoice;
                            
                            if (outcome === 'accepted') {
                                console.log('‚úÖ Usu√°rio instalou o PWA');
                            } else {
                                console.log('‚ùå Usu√°rio recusou instalar o PWA');
                            }
                            
                            deferredPrompt = null;
                            installButton.remove();
                        }
                    });
                    
                    document.body.appendChild(installButton);
                    
                    // Remover bot√£o ap√≥s 10 segundos se n√£o usar
                    setTimeout(() => {
                        if (installButton.parentNode) {
                            installButton.style.opacity = '0.7';
                            setTimeout(() => installButton.remove(), 5000);
                        }
                    }, 10000);
                }
            }

            // Detectar quando o PWA foi instalado
            window.addEventListener('appinstalled', (evt) => {
                console.log('üéâ PWA foi instalado com sucesso!');
                
                // Remover bot√£o de instala√ß√£o se existir
                const installButton = document.getElementById('install-button');
                if (installButton) {
                    installButton.remove();
                }
            });
        }
    </script>
</body>
</html>